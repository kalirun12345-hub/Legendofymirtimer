<!DOCTYPE html>
<html>
<head>
    <title>Admin - Boss Settings</title>
    <style>
        body {
            background: #0f1215;
            color: white;
            font-family: sans-serif;
            text-align: center;
            padding: 20px;
        }

        .box {
            background: #1c2126;
            border: 1px solid #343b42;
            padding: 20px;
            border-radius: 10px;
            max-width: 520px;
            margin: 20px auto;
        }

        select, input {
            padding: 10px;
            width: 90%;
            border-radius: 5px;
            border: 1px solid #d4af37;
            background: #000;
            color: white;
            margin-bottom: 10px;
        }

        button {
            padding: 12px;
            background: #d4af37;
            border: none;
            cursor: pointer;
            font-weight: bold;
            border-radius: 5px;
            width: 95%;
            margin-top: 5px;
        }

        .reset-btn {
            background: #e74c3c;
            color: white;
            margin-top: 15px;
        }

        .status {
            margin-top: 10px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        a {
            color: #d4af37;
            text-decoration: none;
            display: block;
            margin-top: 20px;
        }

        /* ‚úÖ EMBED PREVIEW STYLE */
        .embed-preview {
            margin-top: 15px;
            padding: 15px;
            border-left: 5px solid #d4af37;
            background: rgba(255,255,255,0.05);
            text-align: left;
            border-radius: 8px;
        }

        .embed-title {
            font-weight: bold;
            font-size: 1.05rem;
            margin-bottom: 6px;
            color: #f1c40f;
        }

        .embed-desc {
            font-size: 0.95rem;
            margin-bottom: 10px;
        }

        .embed-field {
            font-size: 0.85rem;
            color: #ccc;
        }
    </style>
</head>
<body>

<h1>‚öôÔ∏è Admin Dashboard</h1>

<!-- RESET BOX -->
<div class="box">
    <h3>üö® Emergency Reset</h3>

    <select id="resetFloor" onchange="updateBossList()">
        <option value="floor1">Floor 1</option>
        <option value="floor2">Floor 2</option>
        <option value="floor3">Floor 3</option>
        <option value="floor4">Floor 4</option>
        <option value="mykriel">Mykriel</option>
    </select>

    <select id="resetBoss"></select>

    <button class="reset-btn" onclick="resetBoss()">
        RESET TIMER & DELETE RECORD
    </button>

    <div id="resetStatus" class="status"></div>
</div>

<!-- SETTINGS BOX -->
<div class="box">
    <h3>System Settings</h3>

    <input type="number" id="respawnMins" placeholder="Respawn Minutes (e.g. 120)">
    <button onclick="saveTime()">Update Timer Settings</button>

    <!-- ‚úÖ DISCORD EMBED PREVIEW -->
    <h3 style="margin-top:20px;">Discord Test Embed Preview</h3>

    <div class="embed-preview">
        <div class="embed-title">‚ö†Ô∏è Boss Respawning Soon!</div>
        <div class="embed-desc">
            <b>TEST BOSS</b> will respawn in <b>2 minutes</b>!
        </div>
        <div class="embed-field">üìç Location: <b>ADMIN PANEL</b></div>
        <div class="embed-field" style="margin-top:8px; color:#888;">
            Footer: Legend of Ymir Boss Tracker
        </div>
    </div>

    <button style="background:#3498db; margin-top:15px;" onclick="testPing()">
        Send Test Embed to Discord
    </button>

    <div id="pingStatus" class="status"></div>
</div>

<p><a href="index.html">‚Üê Back to Tracker</a></p>

<script>
    const GOOGLE_SCRIPT_URL =
        "https://script.google.com/macros/s/AKfycbw4ie1gR4hr5yDlwBimiOPBNWTFFB08sv1aAnodEATR4O0Hk6jwg16otOr1l_7TCpol/exec";

    const floorBosses = ["Volva", "Berserker", "Warlord", "Skald"];

    const mykrielBosses = [
        "66 CH1", "66 CH2",
        "67 CH1", "67 CH2",
        "68 CH1", "68 CH2",
        "69 CH1", "69 CH2"
    ];

    function updateBossList() {
        const floor = document.getElementById("resetFloor").value;
        const bossSelect = document.getElementById("resetBoss");

        bossSelect.innerHTML = "";

        let bossList = floor === "mykriel" ? mykrielBosses : floorBosses;

        bossList.forEach(boss => {
            let option = document.createElement("option");
            option.value = boss;
            option.textContent = boss;
            bossSelect.appendChild(option);
        });
    }

    async function resetBoss() {
        const boss = document.getElementById("resetBoss").value;
        const floor = document.getElementById("resetFloor").value;
        const status = document.getElementById("resetStatus");

        const id = `${floor}-${boss}`;

        status.innerText = "Processing Reset...";
        status.style.color = "#d4af37";

        localStorage.removeItem(id);

        try {
            await fetch(GOOGLE_SCRIPT_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    type: "RESET_BOSS",
                    boss: boss,
                    floor: floor
                })
            });

            status.innerText = `‚úÖ SUCCESS: ${boss} (${floor}) is now ALIVE.`;
            status.style.color = "#2ecc71";

        } catch {
            status.innerText = "‚ùå Error: Could not reset boss.";
            status.style.color = "#e74c3c";
        }
    }

    async function testPing() {
        const pingStatus = document.getElementById("pingStatus");

        pingStatus.innerText = "Sending Test Embed...";
        pingStatus.style.color = "#d4af37";

        try {
            await fetch(GOOGLE_SCRIPT_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ type: "TEST_WEBHOOK" })
            });

            pingStatus.innerText = "‚úÖ Test Embed Sent Successfully!";
            pingStatus.style.color = "#2ecc71";

        } catch {
            pingStatus.innerText = "‚ùå Failed to send embed.";
            pingStatus.style.color = "#e74c3c";
        }
    }

    function saveTime() {
        const mins = document.getElementById("respawnMins").value;
        localStorage.setItem("respawn_setting", mins);
        alert("Global timer set to " + mins + " minutes.");
    }

    document.getElementById("respawnMins").value =
        localStorage.getItem("respawn_setting") || 120;

    updateBossList();
</script>

</body>
</html>
